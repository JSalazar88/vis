<!DOCTYPE HTML>
<html>
  <head>
    <title>Timeline | Manipulation example</title>

    <style>
      body, html {
        font-family: arial, sans-serif;
        font-size: 11pt;
      }

      .vis-item.vis-background.am {
        background: linear-gradient(to right, rgba(90,103,144,1) , rgba(241,192,44,1));
      }
      .vis-item.vis-background.pm {
        background: linear-gradient(to right, rgba(241,192,44,1) , rgba(90,103,144,1));
      }
      .vis-item.vis-background.day {
        background: url("../../../dist/blurry2.jpg");
        background-size: 100% 100%;
      }
      .vis-item.vis-background.am2 {
        background-image:
            url("../../../dist/starsLeft.png"),
            radial-gradient(circle at right,  rgba(241,192,44,1) 0%,rgba(1,1,1,.1) 30%),
            -webkit-linear-gradient(90deg, rgba(1,41,63,0.90) 10%, rgba(1,41,63,0.80) 25%, rgba(166, 230, 255, 0.95) 80%); /* Chrome 10+, Saf5.1+ */
        background-image:
            url("../../../dist/starsLeft.png"),
            radial-gradient(circle at right,  rgba(241,192,44,1) 0%,rgba(1,1,1,.1) 30%),
            -moz-linear-gradient(90deg, rgba(1,41,63,0.90) 10%, rgba(1,41,63,0.80) 25%, rgba(166, 230, 255, 0.95) 80%); /* FF3.6+ */
        background-image:
            url("../../../dist/starsLeft.png"),
            radial-gradient(circle at right,  rgba(241,192,44,1) 0%,rgba(1,1,1,.1) 30%),
            -ms-linear-gradient(90deg, rgba(1,41,63,0.90) 10%, rgba(1,41,63,0.80) 25%, rgba(166, 230, 255, 0.95) 80%); /* IE10 */
        background-image:
            url("../../../dist/starsLeft.png"),
            radial-gradient(circle at right,  rgba(241,192,44,1) 0%,rgba(1,1,1,.1) 30%),
            -o-linear-gradient(90deg, rgba(1,41,63,0.90) 10%, rgba(1,41,63,0.80) 25%, rgba(166, 230, 255, 0.95) 80%); /* Opera 11.10+ */
        background-image:
            url("../../../dist/starsLeft.png"),
            radial-gradient(circle at right,  rgba(241,192,44,1) 0%,rgba(1,1,1,.1) 30%),
            linear-gradient(90deg, rgba(1,41,63,0.90) 10%, rgba(1,41,63,0.80) 25%, rgba(166, 230, 255, 0.95) 80%); /* W3C */
        background-size: 100% 100%;
      }
      .vis-item.vis-background.pm2 {
        background-image:
            url("../../../dist/starsRight.png"),
            radial-gradient(circle at left,  rgba(241,192,44,1) 0%,rgba(1,1,1,.1) 30%),
            -webkit-linear-gradient(90deg, rgba(166, 230, 255, 0.95) 10%, rgba(1,41,63,0.80) 75%, rgba(1,41,63,0.90) 90%); /* Chrome 10+, Saf5.1+ */
        background-image:
            url("../../../dist/starsRight.png"),
            radial-gradient(circle at left,  rgba(241,192,44,1) 0%,rgba(1,1,1,.1) 30%),
            -moz-linear-gradient(90deg, rgba(166, 230, 255, 0.95) 10%, rgba(1,41,63,0.80) 75%, rgba(1,41,63,0.90) 90%); /* FF3.6+ */
        background-image:
            url("../../../dist/starsRight.png"),
            radial-gradient(circle at left,  rgba(241,192,44,1) 0%,rgba(1,1,1,.1) 30%),
            -ms-linear-gradient(90deg, rgba(166, 230, 255, 0.95) 10%, rgba(1,41,63,0.80) 75%, rgba(1,41,63,0.90) 90%); /* IE10 */
        background-image:
            url("../../../dist/starsRight.png"),
            radial-gradient(circle at left,  rgba(241,192,44,1) 0%,rgba(1,1,1,.1) 30%),
            -o-linear-gradient(90deg, rgba(166, 230, 255, 0.95) 10%, rgba(1,41,63,0.80) 75%, rgba(1,41,63,0.90) 90%); /* Opera*/
        background-image:
            url("../../../dist/starsRight.png"),
            radial-gradient(circle at left,  rgba(241,192,44,1) 0%,rgba(1,1,1,.1) 30%),
            linear-gradient(90deg, rgba(166, 230, 255, 0.95) 10%, rgba(1,41,63,0.80) 75%, rgba(1,41,63,0.90) 90%); /* W3C */
        background-size: 100% 100%;
      }

    </style>

  <script src="../../../dist/vis.js"></script>
  <link href="../../../dist/vis-timeline-graph2d.min.css" rel="stylesheet" type="text/css" />


  </head>
  <body>

    <p>Show us what your typical sleep schedule looks like by adjusting the sliders below. You can also drag the timeline as needed (e.g. for shift workers).</p>

    <div id="visualization"></div>
    <div id="log"></div>

    <script type="text/javascript">
      var numSleepItems = 5;
      var numMinutesPerStep = 10;
      var animationDurMillis = 750;
      // create a dataset with items
      // we specify the type of the fields `start` and `end` here to be strings
      // containing an ISO date. The fields will be outputted as ISO dates
      // automatically getting data from the DataSet via items.get().
      var items = new vis.DataSet({
        type: { start: 'ISODate', end: 'ISODate' }
      });
      
      // add items to the DataSet
      var sleepLabels = ["", "Bed Time", "Lights Out", "Fall Asleep", "Wake Up", "Out of Bed"];
      items.add(
      [
        {id: 1, content: `${sleepLabels[1]}: 21:30`, start: '2018-02-20 21:30:00'},
        {id: 2, content: `${sleepLabels[2]}: 22:00`, start: '2018-02-20 22:00:00'},
        {id: 3, content: `${sleepLabels[3]}: 22:45`, start: '2018-02-20 22:45:00'},
        {id: 4, content: `${sleepLabels[4]}: 7:00`,  start: '2018-02-21 07:00:00'},
        {id: 5, content: `${sleepLabels[5]}: 7:55`,  start: '2018-02-21 07:55:00'},
        {id: 'Day1Am', content: '', start: '2018-02-20 00:00:00', end: '2018-02-20 12:00:00', type: 'background', className: 'am2'},
        {id: 'Day1Pm', content: '', start: '2018-02-20 12:00:01', end: '2018-02-20 23:59:59', type: 'background', className: 'pm2'},
        {id: 'Day2Am', content: '', start: '2018-02-21 00:00:00', end: '2018-02-21 12:00:00', type: 'background', className: 'am2'},
        {id: 'Day2Pm', content: '', start: '2018-02-21 12:00:01', end: '2018-02-21 23:59:59', type: 'background', className: 'pm2'},
      ]);

      // log changes to the console
      items.on('*', function (event, properties) {
        console.log(event, properties.items);
      });

      // items.forEach(function (item) {
      //     item.content = `${sleepLabels[item.id]}: ${new Date(item.start).getHours()}:${addZero(new Date(item.start).getMinutes())}`;
      //   });

      var minL = new Date(2018, 1, 20); // 1 april
      var maxR = new Date(2018, 1, 22); // 30 april

      var container = document.getElementById('visualization');
      var options =
      {
        min: minL,             // zero-based index for month
        max: maxR,             // zero-based index for month
        zoomMin: 1000 * 60 * 60 * 12,           // one day in milliseconds
        zoomMax: 1000 * 60 * 60 * 48,           // two days
        height: '300px',
        width: '1200px',

        // allow selecting multiple items using ctrl+click, shift+click, or hold.
        multiselect: false,
        horizontalScroll: true,
        zoomKey: 'ctrlKey',
        timeAxis: {scale: 'minute', step: numMinutesPerStep},
        showMinorLabels: false,
        showMajorLabels: true,

        // enable/disable individual actions:
        editable: true,
        showCurrentTime: false,

        onMoving: function (item, callback) {
          var leftMin = minL;
          var rightMax = maxR;
          var prevIdx = item.id - 1;
          var nextIdx = item.id + 1;

          // update neighbor limits
          if (prevIdx > 0) leftMin = items.get(prevIdx).start;
          if (nextIdx <= numSleepItems) rightMax = items.get(nextIdx).start;

          // bound this item between neighbors
          if (item.start < leftMin) {
            item.start = leftMin;
          }
          if (item.start > rightMax) {
            item.start = rightMax;
          }
          if (item.end   > rightMax) {
            item.end   = rightMax;
          }

          logEvent(item.end, rightMax);

          // update time
          item.content = `${sleepLabels[item.id]}: ${new Date(item.start).getHours()}:${addZero(new Date(item.start).getMinutes())}`;
          
          callback(item); // send back the (possibly) changed item
        }
      };

      var timeline = new vis.Timeline(container, items, options);
      timeline.setWindow('2018-02-20 13:00:00', '2018-02-21 11:00:00', {animation: {duration: animationDurMillis, easingFunction: "easeInOutQuad"}});

      // items.on('*', function (event, properties) {
      //   logEvent(event, properties);
      // });

      function logEvent(event, properties) {
        var log = document.getElementById('log');
        var msg = document.createElement('div');
        msg.innerHTML = 'event=' + JSON.stringify(event) + ', ' +
            'properties=' + JSON.stringify(properties);
        log.firstChild ? log.insertBefore(msg, log.firstChild) : log.appendChild(msg);
      }

      function addZero(i) {
        if (i < 10) {
            i = "0" + i;
        }
        return i;
      }

    </script>
  </body>
</html>